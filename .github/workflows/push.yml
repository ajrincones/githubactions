on: push
name: deploy
jobs:
    deploy:
        name: deploy to cluster
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@master
        - name: build and push to docker
          uses: docker/build-push-action@v2
          with:
            username: ${{ secrets.DOCKER_USERNAME }}
            password: ${{ secrets.DOCKER_PASSWORD }}
            repository: ${{ github.repository }}
            tag_with_ref: true
            tag_with_sha: true
            tags: ${{ github.sha }}
	- name: kubectl - Google Cloud GKE cluster.
      	uses: ameydev/gke-kubectl-action@master
      	env:
       	  PROJECT_ID: ${{ secrets.PROJECT_ID }}
          APPLICATION_CREDENTIALS: ${{ secrets.GOOGLE_APPLICATION_CREDENTIALS }}
          CLUSTER_NAME: ${{ secrets.GKE_CLUSTER_NAME }}
          ZONE_NAME: us-central1-c
      	with:
          args: apply -f packaging/k8s/manifests/ -n staging
